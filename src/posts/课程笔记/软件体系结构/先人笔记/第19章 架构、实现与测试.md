# 第19章 架构、实现与测试

## 架构腐蚀原因

### 实现逐渐偏离文档化的架构

### 开发者可能做出彼此不一或者与架构不一致的实现

### 架构可能没有预见所有将会出现的可能性

## 如何避免架构腐蚀

### 使用工具强制实现架构约束

### 可以在构建或检查期间添加强制性的架构约束

### 当腐蚀发生时，将文档标记为过期。将给剩余的部分更多的信任

### 计划安排 文档／代码 同步时间

## 架构和测试

### 单元测试

### 集成测试

### 网络效应

### 测试活动

## 心跳Heartbeat

### 心跳机制是定时发送一个自定义的结构体(心跳包)，让对方知道自己还活着，以确保连接的有效性的机制

## 沙盒机制Sandbox mechanism

### “沙盒”技术的实践运用流程是：让疑似病毒文件的可疑行为在虚拟的“沙盒”里充分表演，“沙盒”会记下它的每一个动作；当疑似病毒充分暴露了其病毒属性后，“沙盒”就会执行“回滚”机制：将病毒的痕迹和动作抹去，恢复系统到正常状态。

## 看门狗Watchdog

### 加入看门狗目的是对一些程序潜在错误和恶劣环境干扰等因素导致系统死机而在无人干预情况下自动恢复系统正常工作状态。

### 主要用来解决程序CPU异常，程序跑飞挂死等问题，提高系统的可靠性

### 看门狗分硬件看门狗和软件看门狗。硬件看门狗是利用一个定时器电路，其定时输出连接到电路的复位端，程序在一定时间范围内对定时器清零(俗称“喂狗”)。如果程序出现故障，不在定时周期内复位看门狗，就使得看门狗定时器溢出产生复位信号并重启系统。软件看门狗原理上一样，只是将硬件电路上的定时器用处理器的内部定时器代替。

